<!-- Including base.html and loading static -->
{% extends "base.html" %}{% load static %} 

<!-- Title -->
{% block title%} CP {% endblock %} 

<!-- CSS -->
{%block stylesheet %}
<link rel="icon" href="/media/fav.png" />
<link rel="stylesheet" href="/static/css/competitive.css" />
{% endblock %} 

<!-- Main -->
{% block main %}
<div class="main-container">
  <div id="check">
    <div class="clist">
      <div id="butt">
        <button type="button" id="but" class="modal-btn">
          Practice
        </button>
      </div>
      <div class="name" id="1">
        <img src="{% static 'images/pc.png'%}">
      </div>
      <div class="name" id="2">
          <img src="{% static 'images/cc.png' %}">
      </div>
      <div class="name" id="3">
        <img src="{% static 'images/cf.png' %}"
        />
      </div>
      <div class="name" id="4">
       <img src="{% static 'images/ac.png' %}"
        />
      </div>
      <div class="name" id="5">
         <img src="{% static 'images/hr.png' %}"
        />
      </div>
      <div class="name" id="6">
        <img src="{% static 'images/he.png' %}"
        />
      </div>
      <div class="name" id="7">
        <img src="{% static 'images/Google.png' %}"
        />
      </div>
      <div class="name" id="8">
        <img src="{% static 'images/tp.png' %}"
        />
      </div>
    </div>
  </div>
  <div class="ctst" id="checkk"></div>
</div>

<div class="modal-bg">
  <div class="modal">
    <h2>Get Questions</h2>
    <input type="number" name="min" id="min" placeholder="Minimum Rating">
    <input type="number" name="max" id="max" placeholder="Maximum Rating">
    <input type="text" name="username" id="username" placeholder="Codeforces Username">
    <input type="text" name="tag" placeholder=" &quot ; &quot Seperated" id="tag">
    <button type="button" id = "sub_id" class="modalb">Open Questions</button>
    <div class="loading" id="loading">
      <img src="{% static 'images/ajax-loader.gif '%}" >
    </div>
    <span class="modal-close">X</span>
  </div>
</div>
{% endblock %}


<!-- Javascript -->
{% block javascript %}
<script src="{% static 'js/jquery.countdown.js' %}"></script>
<script src="{% static 'js/jquery.countdown.min.js' %}"></script>
<script type="text/javascript">
  $('.name').click(function(e){
    $("#checkk").html("");
    var respid = $(this).attr('id');
    $.ajax({
      type:'POST',
      url:'/cp/',
      data:{
        id:respid,
        choose:'contests',
      },
      success:function(data){
        console.log(data['contest'].length);
        for(let i=0;i<data['contest'].length;i++){
          var name = data['contest'][i]['name'];
          var start = data['contest'][i]['start'];
          var end = data['contest'][i]['end'];
          var duration = data['contest'][i]['duration'];
          var link = data['contest'][i]['link'];
          $('#checkk').append('<div class="contest"><p>' + name + '</p><p>' + start + "</p><p>" + end + "</p><p>" + duration + '<p><p class ="countdown" data-countdown="'+ start +'"> </p><a id="here" href="' + link + '" target= "_blank">' + link + "</a></div>");
        }
        $('[data-countdown]').each(function() {
          var $this = $(this), finalDate = $(this).data('countdown');
          $this.countdown(finalDate, function(event) {
            $this.html(event.strftime('%D days %H:%M:%S'));
          });
        });
      }
    }); 
  });
</script> 
<script>
  var mb = document.querySelector('.modal-btn');
  var md = document.querySelector('.modal-bg'); 
  var mc = document.querySelector('.modal-close');

  mb.addEventListener('click',function(){
    md.classList.add('bg-active');
  });

  mc.addEventListener('click',function(){
    md.classList.remove('bg-active');
  });
</script>
<script type="text/javascript">
       $('#sub_id').click(function(e){
           //$('.loading').show();
          if(document.getElementById('min').value.length==0 || document.getElementById('max').value.length==0 || document.getElementById('max').value.length==0){ 
            alert('Please fill the empty feilds');
          }
          else{
            $.ajax({
              type:'POST',
              url:"/cp/",
              data:{
                  min:$('#min').val(),
                  max:$('#max').val(),
                  username:$('#username').val(),
                  tag:$('#tag').val(),
                  choose:"prob"
                },
              beforeSend:function(){
                  loadingShow();
              },
              success:function(data){
                  console.log(data['prob']);
                  $('#loading').hide();
                  if(data['prob'].length==0){
                    alert("No Questions Found");
                  }
                  //document.getElementById('sub-id').style.display="block";
                  else{
                    for(let i=0;i<data['prob'].length;i++){
                      window.open(data['prob'][i],'_blank');
                    }
                  }
                  //window.open(data['prob'][1],'_blank');
                  //document.getElementById("prob-form").reset();
                  document.getElementById('min').value = '';
                  document.getElementById('max').value = '';
                  document.getElementById('username').value = '';
                  document.getElementById('tag').value = '';
              },
              failure:function(){
                alert("Error in your request, Try Agian !!");
              }
          });
        }
      });              
      function loadingShow(){
          //document.getElementById('sub-id').style.display="none";
          $('#loading').show();
      }
</script>
{% endblock %}
